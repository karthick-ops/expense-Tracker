<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Expense Tracker</title>
  <style>
    :root{
      --bg:#f0f4f9; --fg:#010e03; --muted:#6b7280; --brand:#158b15; --brand-2:#28e231; --card:#ffffff; --border:#6009ec; --red:#ff0d0d;
    }
    *{box-sizing:border-box}
    body{margin:0; font: 16px/1.5 system-ui, Arial; background:var(--bg); color:var(--fg)}
    .container{max-width: 1000px; margin: 32px auto; padding: 0 16px}
    header{display:flex; align-items:center; justify-content:space-between; margin-bottom:16px}
    h1{margin:0; font-size:24px}
    .sub{color:var(--muted); font-size:14px}
    .grid{display:grid; gap:12px}
    .cards{grid-template-columns: repeat(auto-fit, minmax(220px,1fr))}
    .card{background:var(--card); border:1px solid var(--border); border-radius:12px; padding:16px; box-shadow:0 4px 12px rgba(0,0,0,.05)}
    .summary .value{font-size:22px; font-weight:700}
    .summary .label{color:var(--muted); font-size:12px}
    form#expense-form{display:grid; grid-template-columns: repeat(7, 1fr); gap:10px}
    form#expense-form .full{grid-column: 1/-1}
    input, select, button{height:40px; padding:0 10px; border-radius:8px; border:1px solid var(--border); background:#fff}
    input[type="number"]{text-align:right}
    button{cursor:pointer; font-weight:600}
    .btn{background:var(--brand); border:none; color:#fff}
    .btn:hover{background:var(--brand-2)}
    .btn-danger{background:var(--red); border:none; color:#fff}
    table{width:100%; border-collapse:collapse; background:var(--card); margin-top:16px; border:1px solid var(--border); border-radius:8px; overflow:hidden}
    thead th{background:#f9fafb; text-align:left; font-size:13px; color:var(--muted); padding:10px}
    tbody td{padding:10px; border-top:1px solid #eee}
    td.amt{text-align:right}
    td.actions{text-align:right}
    td.actions button{height:28px; margin-left:6px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>My Expense</h1>
        <div class="sub">Daily Expense (Don't Spend unwanted).</div>
      </div>
      <div class="toolbar">
        <button id="export-csv" class="btn">Export CSV</button>
        <button id="clear-all" class="btn-danger">Clear All</button>
      </div>
    </header>

    <section class="grid cards">
      <div class="card summary">
        <div class="label">Entries</div>
        <div class="value" id="entries-count">0</div>
      </div>
      <div class="card summary">
        <div class="label">Credit Cash</div>
        <div class="value" id="credit-cash">₹0</div>
      </div>
      <div class="card summary">
        <div class="label">Debit Cash</div>
        <div class="value" id="debit-cash">₹0</div>
      </div>
      <div class="card summary">
        <div class="label">Overall Balance</div>
        <div class="value" id="balance">₹0</div>
      </div>
      <div class="card summary">
        <div class="label">In Hand Cash (Manual)</div>
        <input id="inhand-input" type="number" placeholder="Enter amount" 
               style="width:100%; margin-top:8px; padding:6px; border-radius:8px; border:1px solid #ccc;" />
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <form id="expense-form" autocomplete="on">
        <input id="date" type="date" required />
        <input id="desc" type="text" placeholder="Description" required />
        <select id="category">
          <option>Food</option><option>Transport</option><option>Bills</option>
          <option>Groceries</option><option>Entertainment</option><option>Health</option>
        </select>
        <select id="type">
          <option value="credit">Credit (+)</option>
          <option value="debit">Debit (-)</option>
        </select>
        <input id="amount" type="number" step="0.01" min="0" placeholder="Amount" required />
        <button class="btn" type="submit">Add</button>
        <button id="cancel-edit" type="button" hidden>Cancel</button>
      </form>
    </section>

    <section>
      <table>
        <thead>
          <tr><th>Date</th><th>Description</th><th>Category</th><th>Type</th><th>Amount</th><th>Actions</th></tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </section>
  </div>

  <script>
    (() => {
      const KEY = 'expense-tracker-v1';
      let expenses = [];
      let editingId = null;
      const inr = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' });

      // DOM
      const form = document.getElementById('expense-form');
      const dateEl = document.getElementById('date');
      const descEl = document.getElementById('desc');
      const catEl = document.getElementById('category');
      const typeEl = document.getElementById('type');
      const amtEl = document.getElementById('amount');
      const cancelEditBtn = document.getElementById('cancel-edit');
      const tbody = document.getElementById('tbody');
      const entriesCountEl = document.getElementById('entries-count');
      const creditCashEl = document.getElementById('credit-cash');
      const debitCashEl = document.getElementById('debit-cash');
      const balanceEl = document.getElementById('balance');
      const inhandInput = document.getElementById('inhand-input');
      const exportBtn = document.getElementById('export-csv');
      const clearAllBtn = document.getElementById('clear-all');

      function todayISO(){ return new Date().toISOString().slice(0,10); }
      function genId(){ return 'e' + Math.random().toString(36).slice(2,9); }
      function load(){ try{ expenses = JSON.parse(localStorage.getItem(KEY) || '[]'); } catch{ expenses = []; } }
      function save(){ localStorage.setItem(KEY, JSON.stringify(expenses)); }

      function render(){
        tbody.innerHTML = '';
        for (const e of expenses){
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${e.date}</td>
            <td>${e.desc}</td>
            <td>${e.category}</td>
            <td>${e.type}</td>
            <td class="amt">${inr.format(e.amount)}</td>
            <td class="actions">
              <button data-edit="${e.id}">Edit</button>
              <button data-del="${e.id}">Delete</button>
            </td>`;
          tbody.appendChild(tr);
        }
        renderSummary();
      }

      function renderSummary(){
        let totalCredit = 0, totalDebit = 0;
        for (const e of expenses){
          if (e.type === 'credit') totalCredit += Number(e.amount);
          else totalDebit += Number(e.amount);
        }
        entriesCountEl.textContent = expenses.length;
        creditCashEl.textContent = inr.format(totalCredit);
        debitCashEl.textContent = inr.format(totalDebit);
        balanceEl.textContent = inr.format(totalCredit - totalDebit);
      }

      function addExpense(data){
        expenses.push({ id: genId(), ...data, amount: Number(data.amount) });
        save(); render();
      }

      function updateExpense(id, data){
        const idx = expenses.findIndex(e => e.id === id);
        if (idx === -1) return;
        expenses[idx] = { ...expenses[idx], ...data, amount: Number(data.amount) };
        save(); render(); cancelEdit();
      }

      function deleteExpense(id){
        if (!confirm('Delete this expense?')) return;
        expenses = expenses.filter(e => e.id !== id);
        save(); render();
      }

      function startEdit(id){
        const e = expenses.find(x => x.id === id);
        if (!e) return;
        editingId = id;
        dateEl.value = e.date; descEl.value = e.desc;
        catEl.value = e.category; typeEl.value = e.type;
        amtEl.value = e.amount; cancelEditBtn.hidden = false;
      }

      function cancelEdit(){
        editingId = null; form.reset(); dateEl.value = todayISO();
        cancelEditBtn.hidden = true;
      }

      form.addEventListener('submit', ev => {
        ev.preventDefault();
        const data = { date: dateEl.value || todayISO(), desc: descEl.value, category: catEl.value, type: typeEl.value, amount: amtEl.value };
        if (editingId) updateExpense(editingId, data); else addExpense(data);
        form.reset(); dateEl.value = todayISO();
      });
      cancelEditBtn.addEventListener('click', cancelEdit);
      tbody.addEventListener('click', ev => {
        if (ev.target.dataset.del) deleteExpense(ev.target.dataset.del);
        if (ev.target.dataset.edit) startEdit(ev.target.dataset.edit);
      });

      exportBtn.addEventListener('click', () => {
        const rows = [['Date','Description','Category','Type','Amount'], ...expenses.map(e => [e.date,e.desc,e.category,e.type,e.amount])];
        const csv = rows.map(r => r.join(',')).join('\n');
        const blob = new Blob([csv], {type:'text/csv'}); const a = document.createElement('a');
        a.href = URL.createObjectURL(blob); a.download = 'expenses.csv'; a.click();
      });

      clearAllBtn.addEventListener('click', () => {
        if (!confirm('Delete ALL expenses?')) return;
        expenses = []; save(); render();
      });

      load(); dateEl.value = todayISO(); render();
    })();
  </script>
</body>
</html>
